"use strict";require(["gitbook","jquery"],function(e,c){var o,r,u,a,s,i,p=500,l=void 0!==history.pushState,t=c("body");function d(e){c(".js_errmsg").hide(),o.addClass("open");var t=0==e.count;o.toggleClass("no-results",t),u.empty(),s.text(e.count),i.text(e.query);var l=e.query;e.results.forEach(function(e){var t=c("<li>",{class:"search-results-item"}),n=c("<h3>"),o=function(e,t){var n;e=w(e),t=w(t);for(var o=b(e),r=b(t),a=0;a<o.length&&!(a>=r.length)&&o[a]==r[a];a++);var s=o.length,i=a,l=[];for(n=0;n<s-i;n++)l.push("..");var c=(u=t,u.split("/").slice(1));var u;for(n=i;n<c;n++)l.push(c[n]);return"/"+c.join("/")}(location.pathname,e.url);-1<o.indexOf("?")?o+="&search-key="+encodeURIComponent(l):o+="?search-key="+encodeURIComponent(l);var r,a=c("<a>",{href:o,text:(r=e.title,f(r.replace(/<em>/g,"").replace(/<\/em>/g,"")))}),s=f(e.body.trim());s.length>p&&(s=s.slice(0,p).trim()+"...");var i=c("<p>").html(s);a.appendTo(n),n.appendTo(t),i.appendTo(t),t.appendTo(u)})}function f(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&amp;/g,"&").replace(/&lt;em&gt;/g,"<em>").replace(/&lt;\/em&gt;/g,"</em>")}function h(e){t.addClass("with-search"),t.addClass("search-loading"),n(e)}var g,m,v,y,n=(g=function(r){c.ajax({url:"/search?action=detail",dataType:"json",data:{page:0,limit:30,blogcategory:2048,search_type:1,query:r},success:function(e){if(e.base_resp)if(0==e.base_resp.ret){for(var t=e.wxadoc_list,n=[],o=0;o<t.length;o++)n.push({title:t[o].title,url:t[o].path,body:t[o].content});d({count:(window.results=n).length,query:r,results:n})}else 200013==e.base_resp.ret&&C("搜索太频繁，请稍后再试");else C("未知错误，请稍后重试")},complete:function(e){t.removeClass("search-loading")}})},m=500,function(){var e=this,t=arguments,n=v&&!y;clearTimeout(y),y=setTimeout(function(){y=null,v||g.apply(e,t)},m),n&&g.apply(e,t)});function w(e){return/^\//.test(e)||(e="/"+e),e=e.split("?")[0]}function b(e){return e.split("/").slice(1,-1)}function C(e){d({count:0,query:"",results:[]}),c(".search-results .no-results .search-results-title").hide(),c(".js_errmsg").text(e).show()}function T(){t.removeClass("with-search"),o.removeClass("open")}function x(){var e=$("q");e&&0<e.length&&(r.val(e),h(e))}function q(){function t(){var e=r.val();0==e.length?T():h(e)}r=c("#book-search-input input"),o=c("#book-search-results"),u=o.find(".search-results-list"),a=o.find(".search-results-title"),s=a.find(".search-results-count"),i=a.find(".search-query");var n=!1;r.on("propertychange",function(e){"value"==e.originalEvent.propertyName&&t()}),r.on("input",function(e){n||(c(this).unbind("propertychange"),n=!0),t()}),r.on("blur",function(e){if(l){var t=function(e,t){t=encodeURIComponent(t);var n,o=window.location.href,r=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");{if(r.test(o))return null!=t?o.replace(r,"$1"+e+"="+t+"$2$3"):(o=(n=o.split("#"))[0].replace(r,"$1$3").replace(/(&|\?)$/,""),void 0!==n[1]&&null!==n[1]&&(o+="#"+n[1]),o);if(null!=t){var a=-1!==o.indexOf("?")?"&":"?";return o=(n=o.split("#"))[0]+a+e+"="+t,void 0!==n[1]&&null!==n[1]&&(o+="#"+n[1]),o}return o}}("q",c(this).val());history.pushState({path:t},null,t)}})}function $(e){var t=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)","i").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}c(".search-results .no-results").append('<h1 class="search-results-title js_errmsg" style="display: none"></h1>'),document.addEventListener("page.change",function(){setTimeout(function(){q(),T(),setTimeout(function(){!function(){var e=$("search-key");if(e&&0<e.length&&(e=decodeURIComponent(e),window.find&&window.getSelection)){document.designMode="on";var n=window.getSelection();n.collapse(document.body,0);for(var o=!1;window.find(e);)o||function(){for(var e=n.anchorNode;!e.tagName&&(e=e.parentElement)!==document&&e!==document.body;);var t=c(e).offset();t&&t.top&&(o=!0,setTimeout(function(){c(".book-body").animate({scrollTop:t.top-100})},100))}(),document.execCommand("foreColor",!1,"#44B549"),n.collapseToEnd();document.designMode="off"}}()},100)})}),e.events.on("page.change",function(){setTimeout(function(){q(),T(),x()})}),e.events.on("search.ready",function(){setTimeout(function(){q(),x()})})});